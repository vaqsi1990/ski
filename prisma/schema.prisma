// prisma/schema.prisma
generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum ProductType {
  SKI
  SNOWBOARD
  SKI_BOOTS
  SNOWBOARD_BOOTS
  ADULT_CLOTH
  CHILD_CLOTH
  ADULT_SKI_SET
  CHILD_SKI_SET
  CHILD_SNOWBOARD_SET
  ADULT_SNOWBOARD_SET
  ACCESSORY
  VEHICLES
  QUAD_BIKE
  BAG
  BURAN
  WRANGLER_JEEP
}

enum ProductSize {
  S
  M
  L
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum LessonLevel {
  BEGINNER      // დამწყები
  INTERMEDIATE  // საშუალოდ მცოდნე
  EXPERT        // ექსპერტი
}

enum LessonLanguage {
  GEORGIAN  // ქართული
  ENGLISH   // ინგლისური
  RUSSIAN   // რუსული
}

enum LessonStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum LessonType {
  SKI
  SNOWBOARD
}

model Product {
  id          String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type        ProductType
  price       Float
  size        ProductSize?
  standard    Boolean      @default(false)
  professional Boolean    @default(false)
  description String?     // Description for sets - what items are included
 
  bookingProducts BookingProduct[]
  createdAt   DateTime     @default(now()) @db.Timestamp(6)
  updatedAt   DateTime     @updatedAt
}

model Booking {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  firstName     String
  lastName      String
  phoneNumber   String
  email         String
  personalId    String
  numberOfPeople String?      // Number of people for the booking
  startDate     DateTime
  endDate       DateTime
  startTime     String?       // Start time in format "HH:MM" (10:00 to 15:00)
  duration      Int?          // Duration in hours (1, 2, or 3)
  status        BookingStatus @default(PENDING)
  totalPrice    Float
  products      BookingProduct[]
  createdAt     DateTime      @default(now()) @db.Timestamp(6)
  updatedAt     DateTime      @updatedAt
}

model BookingProduct {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bookingId String   @db.Uuid
  productId String   @db.Uuid
  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @db.Timestamp(6)

  @@unique([bookingId, productId])
}

model Teacher {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  firstname String
  lastname  String
  lessons   Lesson[]
  createdAt DateTime @default(now()) @db.Timestamp(6)
  updatedAt DateTime @updatedAt
}

model Lesson {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  teacherId     String?        @db.Uuid
  teacher       Teacher?       @relation(fields: [teacherId], references: [id], onDelete: SetNull)
  numberOfPeople Int           // 1-4 people
  duration      Int            // 1, 2, or 3 hours
  level         LessonLevel    // BEGINNER, INTERMEDIATE, EXPERT
  lessonType    LessonType     // SKI, SNOWBOARD
  date          DateTime       @db.Date
  startTime     String         // Time in format "HH:MM" (10:00 to 16:00)
  language      LessonLanguage // GEORGIAN, ENGLISH, RUSSIAN
  firstName     String
  lastName      String
  phoneNumber   String
  email         String
  personalId    String
  status        LessonStatus   @default(PENDING)
  totalPrice    Float          // Price based on numberOfPeople and duration
  createdAt     DateTime       @default(now()) @db.Timestamp(6)
  updatedAt     DateTime       @updatedAt
}

model LessonPricing {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  numberOfPeople Int      // 1-4 people
  duration      Int       // 1, 2, or 3 hours
  price         Float
  createdAt     DateTime  @default(now()) @db.Timestamp(6)
  updatedAt     DateTime  @updatedAt

  @@unique([numberOfPeople, duration])
}

model PriceList {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  itemKey       String   @unique // e.g., 'skiSetStandard', 'gogglesStandard'
  type          String   // e.g., 'standard', 'professional', 'accessory'
  includes      String   // e.g., 'Ski, Boots, Poles'
  price         String   // e.g., '50 ₾', '60-150 ₾'
  createdAt     DateTime  @default(now()) @db.Timestamp(6)
  updatedAt     DateTime  @updatedAt
}